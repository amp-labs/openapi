openapi: 3.0.1
info:
  title: Ampersand public write API
  version: 1.0.0
servers:
  - url: https://write.withampersand.com/v1
paths:
  /projects/{projectIdOrName}/integrations/{integrationId}/objects/{objectName}:
    post:
      summary: Write records
      description: Create, update, or delete records in a SaaS instance. Create and update support synchronous or asynchronous mode; delete is synchronous only. See [Write actions](https://docs.withampersand.com/write-actions) for details.
      operationId: writeRecords
      tags: ["Write"]
      parameters:
        - name: projectIdOrName
          in: path
          required: true
          schema:
            type: string
        - name: integrationId
          in: path
          required: true
          schema:
            type: string
        - name: objectName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        description: Write request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WriteRequest"
            examples:
              single-create:
                summary: Single record create
                value:
                  groupRef: "<groupRef>"
                  type: create
                  mode: synchronous
                  record:
                    email: david@withampersand.com
                    warmthScore: ready-for-close
              single-create-associations:
                summary: Single create with associations (HubSpot)
                value:
                  groupRef: "<groupRef>"
                  type: create
                  mode: synchronous
                  record:
                    email: david@withampersand.com
                    warmthScore: ready-for-close
                  associations:
                    - to:
                        id: "18417469260"
                      types:
                        - associationCategory: HUBSPOT_DEFINED
                          associationTypeId: 279
              single-update:
                summary: Single record update
                value:
                  groupRef: "<groupRef>"
                  type: update
                  mode: synchronous
                  record:
                    id: "003xx000001"
                    email: david@withampersand.com
                    warmthScore: ready-for-close
              single-delete:
                summary: Single record delete
                value:
                  groupRef: "<groupRef>"
                  type: delete
                  record:
                    id: "003xx000001"
              batch-create:
                summary: Batch create
                value:
                  groupRef: "<groupRef>"
                  type: create
                  mode: synchronous
                  batch:
                    - record:
                        email: david@withampersand.com
                        warmthScore: ready-for-close
                    - record:
                        email: hermione@withampersand.com
                        warmthScore: ready-for-close
              auto-batch-create:
                summary: Async create with auto-batch policy
                value:
                  groupRef: "<groupRef>"
                  type: create
                  mode: asynchronous
                  autoBatchPolicy:
                    maxDelayMinutes: 5
                    retryDeadlineHours: 2
                  record:
                    email: david@withampersand.com
                    warmthScore: ready-for-close
      responses:
        200:
          description: The success response
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/WriteResponseSingleSuccess"
                  - $ref: "#/components/schemas/WriteResponseBatch"
              examples:
                single-success:
                  summary: Single record success
                  value:
                    operationId: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
                    result:
                      success: true
                      recordId: "003xx000001"
                      data:
                        email: david@withampersand.com
                        warmthScore: ready-for-close
                batch-success:
                  summary: Batch success
                  value:
                    operationId: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
                    successCount: 2
                    failureCount: 0
                    results:
                      - success: true
                        recordId: "003xx000001"
                      - success: true
                        recordId: "003xx000002"
        400:
          description: The failure response for bad request.
          content:
            text/plain:
              schema:
                type: string
                example: "required field not found"
        422:
          description: Error encountered while creating records
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/WriteResponseSingleFail"
                  - $ref: "#/components/schemas/WriteResponseBatch"
              examples:
                single-fail:
                  summary: Single record failure
                  value:
                    operationId: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
                    errors:
                      - message: "The record with ID 003xx000001 was not found"
                    result:
                      success: false
                batch-fail:
                  summary: Batch failure
                  value:
                    operationId: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
                    successCount: 0
                    failureCount: 2
                    errors:
                      - message: "Batch write failed: provider rolled back all records"
        default:
          description: Error
          content:
            application/problem+json:
              schema:
                $ref: "../problem/problem.yaml#/components/schemas/ApiProblem"
components:
  schemas:
    WriteRequest:
      title: Write Request
      type: object
      required:
        - groupRef
        - type
      properties:
        groupRef:
          type: string
          description:
            The ID of the user group whose SaaS instance you'd like to write data to. This is the ID that was provided
            during installation creation.
        type:
          type: string
          description:
            The type of write operation. The only supported types currently are create, update, and delete.
          enum: [create, update, delete]
          example: create
        mode:
          type: string
          description: The mode of write operation.
          enum: [synchronous, asynchronous]
          example: synchronous
        retryPolicy:
          type: object
          description: The retry policy for an asynchronous write operation. Ignored when autoBatchPolicy is specified.
          properties:
            deadlineHours:
              type: integer
              description: The maximum number of hours to wait for the write operation to complete. If not specified, defaults to 1 hour.
              example: 24
              default: 1
              minimum: 1
              maximum: 48
        autoBatchPolicy:
          type: object
          description: |
            The auto-batch policy for asynchronous single-record write operations. When enabled, multiple single-record write requests are automatically grouped together and executed as a batch. The batch executes when either 100 records accumulate or the maximum delay time expires. 
            Auto batching is currently only available for asynchronous mode and single-record writes.
          properties:
            maxDelayMinutes:
              type: integer
              description: |
                The maximum time to wait before executing the batch, even if it hasn't reached 100 records. 
                Once this time expires, the batch will be executed even if it hasn't reached the limit.
              example: 5
              minimum: 1
              maximum: 1440
            retryDeadlineHours:
              type: integer
              description: |
                The maximum time to keep retrying the batch write operation if it fails. 
                If not specified, defaults to 1 hour.
              example: 2
              default: 1
              minimum: 1
              maximum: 48
          required:
            - maxDelayMinutes
        record:
          type: object
          description: |
            The record to write. Use this when sending a single record. Omit this and use `batch` instead when sending multiple records in one request.
            For create and update, include the record fields. For delete, only the record `id` is required; deletion must be enabled for this object in the installation config.
          additionalProperties: true
          example:
            {
              "email": "david@withampersand.com",
              "warmthScore": "ready-for-close",
            }
        batch:
          type: array
          description: |
            Write 1â€“100 records in one request. Omit this and use `record` instead when sending a single record.
            Partial writes are not supported; if any record in the batch is invalid, the entire batch fails.
            Batch is currently supported for create and update write requests.
          minItems: 1
          maxItems: 100
          items:
            type: object
            required: [record]
            properties:
              record:
                type: object
                description: The record to write
                additionalProperties: true
                example:
                  {
                    "email": "david@withampersand.com",
                    "warmthScore": "ready-for-close",
                  }
              associations:
                type: array
                items:
                  type: object
                description: "To write associations to the record. Note: currently only HubSpot associations are supported"
                example:
                  [
                    { "to": {"id": "18417469260"},
                      "types": [{
                          "associationCategory": "HUBSPOT_DEFINED",
                          "associationTypeId": 279
                      }]}
                  ]
        associations:
          type: array
          items:
            type: object
          description: "To write associations to the record (for single record mode). Note: currently only HubSpot associations are supported"
          example:
            [
              { "to": {"id": "18417469260"},
                "types": [{
                    "associationCategory": "HUBSPOT_DEFINED",
                    "associationTypeId": 279
                }]}
            ]
        headers:
          type: array
          items:
            type: object
            properties:
              key:
                type: string
                description: The key of the header
              value:
                type: string
                description: The value of the header
          description: "To write headers to the record. Note: currently only Salesforce headers are supported"
          example:
            [
              { "key": "custom-header-key1", "value": "custom-header-value1" },
              { "key": "custom-header-key2", "value": "custom-header-value2" }
            ]
    WriteResponseSingleSuccess:
      title: Sync Write Response Success
      type: object
      required:
        - operationId
      additionalProperties: false
      properties:
        result:
          $ref: "#/components/schemas/WriteResult"
          description: The result of the write operation. Only present for synchronous operations.
        operationId:
          type: string
          description: The operation ID
          example: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
    WriteResponseSingleFail:
      title: Sync Write Response Failure
      type: object
      required:
        - errors
        - operationId
      additionalProperties: false
      properties:
        rawResponse:
          type: string
          description: The raw response from the provider, if available
          example: "{\"error\": \"Record not found\"}"
          x-go-type-skip-optional-pointer: true
        errors:
          type: array
          description: Error messages resulted in failures
          items:
            type: object
            properties:
              message:
                type: string
                description: errors messages when some unexpected event happened, but write to provider was successful
                example: "The record with ID 003Dp0X#@RG7IAP was not found"
        result:
          $ref: "#/components/schemas/WriteResult"
        warnings:
          type: array
          description: Warnings messages when some unexpected event happened, but not blocking failures
          items:
            type: object
            properties:
              message:
                type: string
                description: errors messages when some unexpected event happened, but write to provider was successful
                example: "The record with ID 003Dp0X#@RG7IAP was not found"
        operationId:
          type: string
          description: The operation ID
          example: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
    WriteResponseBatch:
      title: Batch Write Response
      type: object
      required:
        - operationId
        - successCount
        - failureCount
      additionalProperties: false
      properties:
        operationId:
          type: string
          description: The operation ID
          example: acb0d75a-1b59-4aad-a191-48c5b75ea9e4
        results:
          type: array
          description: Per-record results returned by the provider
          items:
            $ref: "#/components/schemas/WriteResult"
        successCount:
          type: integer
          description: Number of records that succeeded
          example: 3
        failureCount:
          type: integer
          description: Number of records that failed
          example: 1
        errors:
          type: array
          description: Top-level errors returned by the provider, if any
          items:
            type: object
            properties:
              message:
                type: string
                description: Error summary message
                example: "Batch write failed: provider rolled back all records"
        rawResponse:
          type: string
          description: Raw provider response body when available
          example: "{\"hasErrors\": true}"
          x-go-type-skip-optional-pointer: true
    WriteResult:
      title: Write Result
      type: object
      required:
        - success
      additionalProperties: false
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        data:
          type: object
          description: The data returned by the operation
          example: { "email": "david@ampersand.com" }
        recordId:
          type: string
          description: The ID of the object
          example: 003Dp0X#@RG7IAP
  securitySchemes:
    APIKeyHeader:
      type: apiKey
      name: X-Api-Key
      in: header
    APIKeyQueryParam:
      type: apiKey
      name: apiKey
      in: query
    Bearer:
      type: apiKey
      name: Authorization
      in: header
security:
  - APIKeyHeader: []
